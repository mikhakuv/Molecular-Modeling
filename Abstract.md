# Молекулярное моделирование в биологии и пути его развития
*Кувакин М.С. Б07-103*

## Введение
В данной работе обсуждается метод молекулярного моделирования: его история, применение в биологии, возможные перспективы развития. Основную информацию по теме я взял из лекции от 24.11.2023 ведущего научного сотрудника кафедры биофизики И.Б.Коваленко, технические подробности и примеры использования найдены в перечисленных ниже источниках, а идеи применения технологий машинного обучения оригинальные.

## История
Первым поводом к развитию данной области стали достижения ядерной физики, давшие представления о структуре молекул, атомов и химических связях между ними. Но молекулярное моделирование так и осталось бы в стадии 
сбора моделей из конструктора, если бы не достижения вычислительной техники. Рост производительности позволил сначала визуализировать модели соединений, а потом и моделировать их взаимодействие. 1983 год считают началом 
новой эры в развитии молекулярного моделирования, ведь именно в этом году началось распространение программы Model, написанной в Колумбийском университете. Она позволяла графически изобразить соединение с учётом заряда, гидрофобности и прочих характеристик. Уже в 1986 году была создана программа STRFIT, способная моделировать молекулярное взаимодействие без учёта валентных и торсионных углов. Современные программы молекулярного моделирования такие как GROMACS конечно учитывают валентные и торсионные углы химических связей и способны  моделировать достаточно масштабные и продолжительные молекулярные взаимодействия. [[1]](#Использованные-источники)  

## Области молекулярного моделирования
Молекулярное моделирование можно разделить на 3 подхода по степени детализации: квантовая механика, молекулярная динамика, броуновская динамика.
Самая детализированная модель предоставляется квантовой механикой, но из-за этого растёт вычислительная сложность симуляции и уменьшаются потенциальные масштабы моделирования: размер системы и время симуляции.
В то же время самый упрощённый подход - броуновская динамика, не учитывает внутримолекулярных взаимодействий, из-за чего не применим для симуляций на микроуровне. Примерные границы применимости методов при текущих вычислительных возможностях можно увидеть на графике 1.  

<p align="center"><img src="https://github.com/mikhakuv/Molecular_Modelling/blob/main/charts/chart1.png"><br><caption>График 1</caption></p>  

Рассмотрим каждый из подходов в деталях:  
### Квантовая механика
Квантовая механика учитывает внутреннюю структуру атомов, а именно поведение электронов на оболочках. Это даёт возможность наблюдать разрушение и образование связей между атомами. Для упрощения используется приближение Борна-Оппенгеймера, которое отделяет движение электронов от движения ядер. Более того, положение ядер считается фиксированным.
Основной задачей является вычисление волновых функций $\psi_i(\vec{r})$ заполненных орбиталей. Каждая волновая функция находится с помощью метода Хартри-Фока, который подразумевает повторение следующих действий: из уравнения Хартри-Фока определяются волновые функции; найденные волновые функции используются для того чтобы изменить вид потенциала в исходном уравнении; уравнения Хартри-Фока с изменённым потенциалом решаются снова. Цикл повторяется пока изменение волновых функций не станет достаточно мало. При этом сложное по виду уравнение Хартри-Фока можно свести к более простому матричному уравнению Рутана-Холла если искать решение в базисе гауссовских орбиталей или орбиталей слэтеровского типа.
Зная волновые функции орбиталей можно определить: электронную плотность, порядок связи(bond order) и электростатический потенциал молекулы. [[2]](#Использованные-источники)  
### Молекулярная динамика
Молекулярная динамика представляет молекулу как набор атомов, связанных между собой упругими связями. Поведение каждого атома предсказывается исходя из второго закона Ньютона, который в данном случае имеет вид:  

$$m\cdot \frac{d^2\vec{r}}{dt^2} = \vec{F_{ex}}-grad(U)$$  

где $\vec{F_{ex}}$ - сила взаимодействия атома с молекулами среды, а $U$ - потенциальная энергия, которая складывается из нескольких компонент:  

$$U = U_b + U_v + U_{\phi} + U_{q} + U_{vw}$$

$U_b = \sum_{i} \frac{k_i}{2}(l_i-l_{i_0})^2$ - потенциальная энергия растяжения связей. Используется формула Гука, которая на малых расстояниях приближает потенциал Морзе химической связи  
$U_v = \sum_{i} \frac{k_i}{2}(\theta_i-\theta_{i_0})^2$ - потенциальная энергия углового изгиба связей. Также используется формула Гука, но можно увеличить точность, добавляя множители более высоких порядков  
$U_{\phi} = \sum_{i} \frac{v_i}{2}(1+cos(iw-\gamma_i))$ - потенциальная энергия торсионных углов. Формула Гука не используется потому, что у связи может быть несколько торсионных углов, в которых достигается минимум энергии  
$U_{q} = \sum_{i} \frac{q q_i}{4 \pi \varepsilon_0 |\vec{r} - \vec{r_i}|}$ - потенциальная энергия электростатического взаимодействия со всеми другими атомами, полученная из закона Кулона  
$U_{vw} = \sum_{i} (\frac{A}{\vec{r}-\vec{r_i}})^{12} - (\frac{C}{|\vec{r}-\vec{r_i}|})^{6}$ - потенциальная энергия взаимодействий Ван-дер-Ваальса, описываемая потенциалом Ленарда-Джонса. Притягивающая часть имеет степень 6, а отталкивающая степень 12. Эта формула хорошо подходит для разреженных газов, но может быть слишком резкой в других случаях  
$U_b$ и $U_v$ соответствуют жёстким степеням свободы и нужно приложить много энергии, чтобы поменять величины, которым они соответствуют. Большинство изменений в структуре молекулы происходит как раз за счёт поворота торсионных углов и соответственно изменения $U_{\phi}$. На графике 2 приведены иллюстрации взаимодействий.  

<p align="center"><img src="https://github.com/mikhakuv/Molecular_Modelling/blob/main/charts/chart2.png"><br><caption>График 2</caption></p>  

В итоге на каждой итерации симуляции для каждого атома решается приведённое выше уравнение и находится соответствующее изменение положения $d\vec{r}$. [[2]](#Использованные-источники)  
### Броуновская динамика 
Броуновская динамика моделирует поведение молекул как целых исходя из уравнений Ньютона. Запишем второй закон Ньютона для молекулы:  

$$\vec{F} = m\cdot \vec{a}$$

В нашем случае на молекулу действуют 3 силы: электростатическая сила $\vec{F_e} = -q\cdot grad(\phi)$, случайная вынуждающая сила $\vec{F_r}$(для которой выполняются условия $\langle F_{r\ i} \rangle=0,\ \langle F_{r\ i}^2 \rangle=\frac{2kT \epsilon}{\delta t}$) и сила трения $F_{fr} = -\epsilon\cdot \vec{v}$. Предполагая, что из-за большой вязкости воды молекула движется без ускорения, можно получить уравнение Ланжевена:  

$$\epsilon\cdot \frac{d\vec{r}}{dt} = \vec{F_r} - q\cdot grad(\phi)$$

Именно оно и используется для описания движения молекул. При этом такие величины как коэффициент вязкого трения $\epsilon$ и электростатический потенциал $\phi$ вычисляются отдельно.  
Для вычисления коэффициента вязкого трения используется приближение молекулы к более простым по форме объектам. Чаще всего это эллипсоиды вращения, для которых известны формулы этих коэффициентов.  
Электростатический потенциал находится с учётом электрической плотности зарядов в белке $\rho_p(\vec{r})$ и наличия заряженных ионов в растворе(с концентрацией $c_k$ и зарядом $z_k$). Также учитывается изменение диэлектрической проницаемости $\varepsilon(\vec{r})$ в пространстве. Для нахождения $\phi(\vec{r})$ используется уравнение Пуассона-Больцмана:  

$$div(\varepsilon\cdot grad(\phi)) = -4\pi(\rho_p + \sum_{k=1}^{N} c_k z_k e\ exp(-\frac{z_k e \phi}{RT}))$$

Его можно линеаризовать:

$$div(\varepsilon\cdot grad(\phi)) = -4\pi(\rho_p + \phi \frac{N_A e^{2} }{kT} \sum_{k=1}^{N} c_k z_k^2 )$$  

И решать разностной схемой каждую итерацию моделирования, ведь величины $\rho(\vec{r})$ и $\varepsilon(\vec{r})$ меняются вместе с движением белков.  

## Применение в биологии
В биологии метод молекулярного моделирования применяется в широком спектре направлений и даёт замечательные результаты:  
* **Исследование механизмов взаимодействия белков**  
Если структура изучаемых белков известна, то можно смоделировать их взаимодействие в растворе. При этом нужно учесть как диффузионные, так и электростатические взаимодействия, а также присутствие внутри раствора ионов. Иногда процесс моделирования делится на несколько этапов: до сближения используются методы броуновской динамики, а после образования столкновительного комплекса используют методы молекулярной динамики. В работе [[3]](#Использованные-источники) исследовалось взаимодействие двух синтетических противовирусных пептидов DET2 и DET4 с белком оболочки вируса денге. При моделировании взаимодействий с помощью метода молекулярной динамики выяснилось, что DET4 связывается с белком гораздо лучше, чем DET2 и поэтому сможет успешнее блокировать белок и тем самым препятствовать прикреплению вируса к клеткам человека. Для Малайзии, где эта статья написана, вирус денге является серьёзной проблемой и поэтому полученный результат достаточно важен.  
* **Исследование взаимодействия мембран с различными соединениями**  
Можно моделировать взаимодействие мембран бактерий, вирусов или клеток с различными соединениями. Зачастую моделируется взаимодействие мембран бактерий с лекарственными препаратами, но не всегда. Например, в работе [[4]](#Использованные-источники) изучается связывание альфа-синуклеина с клеточной мембраной. Это соединение связано с нейродегенеративными заболеваниями, такими как болезнь Паркинсона или слабоумие и считается токсичным для нейронов. Молекулярное моделирование дало интересные результаты. Оказалось, что при контакте альфа-синуклеина с мембраной одна из молекул, имеющая форму спирали, испытывает конформационный переход и перестаёт быть таковой. Это подтвердило идею о том, что токсичность этого соединения связана именно с его действием на мембрану.  
* **Исследование влияния мутаций на поведение белков**  
Под действием мутаций при образовании белка, например изменении нескольких аминокислотных остатков, может заметно измениться электростатический потенциал. Это приведёт к изменению свойств белка, в частности ухудшению связывания с другими соединениями. К примеру, в работе [[5]](#Использованные-источники) рассматривается влияние мутаций циклинзависимой киназы 4 на функции комплекса, в котором она состоит, и который осуществляет переход между фазами в клеточном цикле. Используя метод молекулярной динамики, авторы наблюдали ухудшение гибкости соединения и ухудшение связывания комплекса с флавопиридолом. Флавопиридол проходит испытания в качестве лекарственного средства и полученные результаты могут говорить о снижении его эффективности.  

## Пути развития
Как показано ранее, метод молекулярного моделирования уже сейчас может давать превосходные результаты, но это не отменяет существующих ограничений. В данном разделе обсуждаются пути преодоления этих ограничений и невооружённым глазом видно только два: увеличение вычислительной мощности и уменьшение вычислительной сложности.
### Увеличение вычислительной мощности
На самом деле вычислительные мощности с теченем времени значительно растут независимо от целей развития молекулярного моделирования. Появление графических ускорителей, способных быстро производить параллельные вычисления также дало весомый вклад, позволив наравне с дорогостоящими кластерами использовать обычные компьютеры с мощными видеокартами. Всё это позволяет увеличивать масштабы моделей никак не совершенствуя вычислительные алгоритмы. На графике 3(построенном по данным И.Б.Коваленко) изображена скорость моделирования на компьютере с видеокартами примерно одной ценовой категории в зависимости от года.  

<p align="center"><img src="https://github.com/mikhakuv/Molecular_Modelling/blob/main/charts/chart3.png"><br><caption>График 3</caption></p>  

Можно заметить, что зависимость похожа на линейную и даже предположить, что в ближайшие годы скорость симуляции будет увеличиваться в среднем на 55 нс/день.
### Уменьшение вычислительной сложности
Тем не менее, может быть и другой путь, позволяющий увеличить объём симуляции без совершенствования вычислительных устройств. Он связан с развитием алгоритмов, применяемых при молекулярном моделировании. И в этом могут помочь не только численные методы, но и машинное обучение. Есть несколько идей, применимых к обсуждаемым методам:  
* **Physics Informed Neural Networks**  
Эта технология, впервые представленная в работе [[6]](#Использованные-источники) позволяет решать дифференциальные уравнения. Решение находится в виде нейросети и процесс решения уравнения сводится к задаче подбора параметров нейросети таких, чтобы невязка на уравнении была как можно меньше. Полный принцип работы можно увидеть на графике 4.  

<p align="center"><img src="https://github.com/mikhakuv/Molecular_Modelling/blob/main/charts/chart4.png"><br><caption>График 4</caption></p>  

Применительно к молекулярному моделированию этот метод может быть использован в области квантовой механики. Уравнение Шрёдингера пока имеет аналитическое решение лишь в простейших ситуациях и приходится использовать упрощения, решать матричные нелинейные уравнения(Рутана-Холла) и сильно усложнять теорию. Всего этого можно избежать, если решать уравнение Шрёдингера с помощью технологии PINN. Потенциальная проблема может заключаться в том, что при росте размера области и порядка уравнения этой технологии может потребоваться ощутимое время для решения и существующие алгоритмы окажутся выгоднее с точки зрения скорости.  
* **Deep Operator Networks**  
Метод DeepONet был предложен немного позже PINN в работе [[7]](#Использованные-источники) и тоже предназначен для решения дифференциальных уравнений. Его отличие в том, что нейросеть работает как функционал: она на вход получает начальное условие и для него может сразу же выдавать решение заранее заданного уравнения. Для этого сначала происходит обучение на различных начальных условиях и соответствующих им решениях. В своей работе авторы показали, что когда нейросеть обучена, процесс выдачи решения часто оказывается гораздо быстрее нахождения численного решения. В молекулярном моделировании это может пригодиться при решении уравнения Пуассона - Больцмана для рассчёта электростатического потенциала. Но так как у данного уравнения может не быть аналитического решения, нужно использовать модифицированную технологию PIDeepONet из работы [[8]](#Использованные-источники), не требующую аналитических решений при обучении. Использование данной технологии может существенно ускорить определение электростатического потенциала молекулы, а значит и весь процесс моделирования. Самый существенный недостаток данной технологии заключается в том, что процесс обучения нейросети может занять продолжительное время(известны примеры, когда нейросеть обучалась около месяца). Но один раз потратив время на обучение нейросети решению уравнения Пуассона-Больцмана, можно получить значительное приращение к скорости.

## Заключение
В данной работе были рассмотрены области молекулярного моделирования и примеры их успешного применения в биологии. Но наиболее важной частью работы является обсуждение ограничений в применении методов и пути их обхода. К сожалению, в данной работе не реализуются предлагаемые идеи, но рано или поздно это будет сделано, если они достаточно хороши.  

## Использованные источники
[1] Matthew F. Schlecht *"Molecular Modeling on the PC"*  
[2] Andrew R. Leach *"Molecular Modelling: Principles and Applications"*  
[3] Vannajan S. Lee et al *"Dynamics and binding interactions of peptide inhibitors of dengue virus entry"*  
[4] Mark S.P. Sandom et al *"Membrane Interactions ofα‑Synuclein Revealed by MultiscaleMolecular Dynamics Simulations, Markov State Models, and NMR"*  
[5] Luonan Chen et al *"Analysing the Effect of Mutation on Protein Function and Discovering Potential Inhibitors of CDK4: Molecular Modelling and Dynamics Studies"*  
[6] Maziar Raissi et al *"Physics Informed Deep Learning (Part I): Data-driven Solutions of Nonlinear Partial Differential Equations"*  
[7] George Em Karniadakis et al *"Learning nonlinear operators via DeepONet based on the universal approximation theorem of operators"*  
[8] George Em Karniadakis et al *"Physics-Informed Deep Neural Operator Networks"*  
